{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[{"file_id":"1b7aZamr065WPuLpq9C4RU6irB59gbX_K","timestamp":1666261078872}],"collapsed_sections":[]},"kernelspec":{"name":"python3","display_name":"Python 3"},"widgets":{"application/vnd.jupyter.widget-state+json":{"020764953be747509ecbed599eeeaf08":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_949c30a86a6448d4b97fd02a11b60811","IPY_MODEL_eca36f7605d147849bc66bb5c8b9cb21","IPY_MODEL_cbc81fe9f41745d7bff961d993ba76e4"],"layout":"IPY_MODEL_190edb9d78df49b5abfae354d105c2c6"}},"949c30a86a6448d4b97fd02a11b60811":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_22f988f9f9ff4e19958aef12caa72bda","placeholder":"​","style":"IPY_MODEL_459106e0ff0340b4b8c68d277e9fd11e","value":""}},"eca36f7605d147849bc66bb5c8b9cb21":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0fa99d85b55649fb9227e56ef751aa53","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b295dc0513964184aafefeac80693536","value":1}},"cbc81fe9f41745d7bff961d993ba76e4":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_878d64634c9d4e3d92d6db323976d563","placeholder":"​","style":"IPY_MODEL_9cb30a6d9b0b4270bd19a2c7c2ce6dc8","value":" 9149/? [00:00&lt;00:00, 18765.14it/s]"}},"190edb9d78df49b5abfae354d105c2c6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"22f988f9f9ff4e19958aef12caa72bda":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"459106e0ff0340b4b8c68d277e9fd11e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0fa99d85b55649fb9227e56ef751aa53":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"b295dc0513964184aafefeac80693536":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"878d64634c9d4e3d92d6db323976d563":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9cb30a6d9b0b4270bd19a2c7c2ce6dc8":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}},"accelerator":"GPU"},"cells":[{"cell_type":"code","metadata":{"id":"cVWONqDLmhOw","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1666302883843,"user_tz":-180,"elapsed":63679,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"9e14a81d-fd11-448c-f034-a2b0eebf64a5"},"source":["import os\n","import re\n","from tqdm import tqdm\n","import numpy as np\n","import pandas as pd\n","import nltk\n","nltk.download(\"all\")\n","import matplotlib.pyplot as plt\n","import torch"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["[nltk_data] Downloading collection 'all'\n","[nltk_data]    | \n","[nltk_data]    | Downloading package abc to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/abc.zip.\n","[nltk_data]    | Downloading package alpino to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/alpino.zip.\n","[nltk_data]    | Downloading package averaged_perceptron_tagger to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping taggers/averaged_perceptron_tagger.zip.\n","[nltk_data]    | Downloading package averaged_perceptron_tagger_ru to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping\n","[nltk_data]    |       taggers/averaged_perceptron_tagger_ru.zip.\n","[nltk_data]    | Downloading package basque_grammars to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping grammars/basque_grammars.zip.\n","[nltk_data]    | Downloading package biocreative_ppi to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/biocreative_ppi.zip.\n","[nltk_data]    | Downloading package bllip_wsj_no_aux to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping models/bllip_wsj_no_aux.zip.\n","[nltk_data]    | Downloading package book_grammars to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping grammars/book_grammars.zip.\n","[nltk_data]    | Downloading package brown to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/brown.zip.\n","[nltk_data]    | Downloading package brown_tei to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/brown_tei.zip.\n","[nltk_data]    | Downloading package cess_cat to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/cess_cat.zip.\n","[nltk_data]    | Downloading package cess_esp to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/cess_esp.zip.\n","[nltk_data]    | Downloading package chat80 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/chat80.zip.\n","[nltk_data]    | Downloading package city_database to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/city_database.zip.\n","[nltk_data]    | Downloading package cmudict to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/cmudict.zip.\n","[nltk_data]    | Downloading package comparative_sentences to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/comparative_sentences.zip.\n","[nltk_data]    | Downloading package comtrans to /root/nltk_data...\n","[nltk_data]    | Downloading package conll2000 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/conll2000.zip.\n","[nltk_data]    | Downloading package conll2002 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/conll2002.zip.\n","[nltk_data]    | Downloading package conll2007 to /root/nltk_data...\n","[nltk_data]    | Downloading package crubadan to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/crubadan.zip.\n","[nltk_data]    | Downloading package dependency_treebank to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/dependency_treebank.zip.\n","[nltk_data]    | Downloading package dolch to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/dolch.zip.\n","[nltk_data]    | Downloading package europarl_raw to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/europarl_raw.zip.\n","[nltk_data]    | Downloading package extended_omw to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    | Downloading package floresta to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/floresta.zip.\n","[nltk_data]    | Downloading package framenet_v15 to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/framenet_v15.zip.\n","[nltk_data]    | Downloading package framenet_v17 to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/framenet_v17.zip.\n","[nltk_data]    | Downloading package gazetteers to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/gazetteers.zip.\n","[nltk_data]    | Downloading package genesis to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/genesis.zip.\n","[nltk_data]    | Downloading package gutenberg to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/gutenberg.zip.\n","[nltk_data]    | Downloading package ieer to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/ieer.zip.\n","[nltk_data]    | Downloading package inaugural to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/inaugural.zip.\n","[nltk_data]    | Downloading package indian to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/indian.zip.\n","[nltk_data]    | Downloading package jeita to /root/nltk_data...\n","[nltk_data]    | Downloading package kimmo to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/kimmo.zip.\n","[nltk_data]    | Downloading package knbc to /root/nltk_data...\n","[nltk_data]    | Downloading package large_grammars to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping grammars/large_grammars.zip.\n","[nltk_data]    | Downloading package lin_thesaurus to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/lin_thesaurus.zip.\n","[nltk_data]    | Downloading package mac_morpho to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/mac_morpho.zip.\n","[nltk_data]    | Downloading package machado to /root/nltk_data...\n","[nltk_data]    | Downloading package masc_tagged to /root/nltk_data...\n","[nltk_data]    | Downloading package maxent_ne_chunker to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping chunkers/maxent_ne_chunker.zip.\n","[nltk_data]    | Downloading package maxent_treebank_pos_tagger to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping taggers/maxent_treebank_pos_tagger.zip.\n","[nltk_data]    | Downloading package moses_sample to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping models/moses_sample.zip.\n","[nltk_data]    | Downloading package movie_reviews to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/movie_reviews.zip.\n","[nltk_data]    | Downloading package mte_teip5 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/mte_teip5.zip.\n","[nltk_data]    | Downloading package mwa_ppdb to /root/nltk_data...\n","[nltk_data]    |   Unzipping misc/mwa_ppdb.zip.\n","[nltk_data]    | Downloading package names to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/names.zip.\n","[nltk_data]    | Downloading package nombank.1.0 to /root/nltk_data...\n","[nltk_data]    | Downloading package nonbreaking_prefixes to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/nonbreaking_prefixes.zip.\n","[nltk_data]    | Downloading package nps_chat to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/nps_chat.zip.\n","[nltk_data]    | Downloading package omw to /root/nltk_data...\n","[nltk_data]    | Downloading package omw-1.4 to /root/nltk_data...\n","[nltk_data]    | Downloading package opinion_lexicon to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/opinion_lexicon.zip.\n","[nltk_data]    | Downloading package panlex_swadesh to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    | Downloading package paradigms to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/paradigms.zip.\n","[nltk_data]    | Downloading package pe08 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/pe08.zip.\n","[nltk_data]    | Downloading package perluniprops to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping misc/perluniprops.zip.\n","[nltk_data]    | Downloading package pil to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/pil.zip.\n","[nltk_data]    | Downloading package pl196x to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/pl196x.zip.\n","[nltk_data]    | Downloading package porter_test to /root/nltk_data...\n","[nltk_data]    |   Unzipping stemmers/porter_test.zip.\n","[nltk_data]    | Downloading package ppattach to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/ppattach.zip.\n","[nltk_data]    | Downloading package problem_reports to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/problem_reports.zip.\n","[nltk_data]    | Downloading package product_reviews_1 to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/product_reviews_1.zip.\n","[nltk_data]    | Downloading package product_reviews_2 to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/product_reviews_2.zip.\n","[nltk_data]    | Downloading package propbank to /root/nltk_data...\n","[nltk_data]    | Downloading package pros_cons to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/pros_cons.zip.\n","[nltk_data]    | Downloading package ptb to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/ptb.zip.\n","[nltk_data]    | Downloading package punkt to /root/nltk_data...\n","[nltk_data]    |   Unzipping tokenizers/punkt.zip.\n","[nltk_data]    | Downloading package qc to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/qc.zip.\n","[nltk_data]    | Downloading package reuters to /root/nltk_data...\n","[nltk_data]    | Downloading package rslp to /root/nltk_data...\n","[nltk_data]    |   Unzipping stemmers/rslp.zip.\n","[nltk_data]    | Downloading package rte to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/rte.zip.\n","[nltk_data]    | Downloading package sample_grammars to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping grammars/sample_grammars.zip.\n","[nltk_data]    | Downloading package semcor to /root/nltk_data...\n","[nltk_data]    | Downloading package senseval to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/senseval.zip.\n","[nltk_data]    | Downloading package sentence_polarity to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/sentence_polarity.zip.\n","[nltk_data]    | Downloading package sentiwordnet to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/sentiwordnet.zip.\n","[nltk_data]    | Downloading package shakespeare to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/shakespeare.zip.\n","[nltk_data]    | Downloading package sinica_treebank to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/sinica_treebank.zip.\n","[nltk_data]    | Downloading package smultron to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/smultron.zip.\n","[nltk_data]    | Downloading package snowball_data to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    | Downloading package spanish_grammars to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping grammars/spanish_grammars.zip.\n","[nltk_data]    | Downloading package state_union to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/state_union.zip.\n","[nltk_data]    | Downloading package stopwords to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/stopwords.zip.\n","[nltk_data]    | Downloading package subjectivity to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/subjectivity.zip.\n","[nltk_data]    | Downloading package swadesh to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/swadesh.zip.\n","[nltk_data]    | Downloading package switchboard to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/switchboard.zip.\n","[nltk_data]    | Downloading package tagsets to /root/nltk_data...\n","[nltk_data]    |   Unzipping help/tagsets.zip.\n","[nltk_data]    | Downloading package timit to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/timit.zip.\n","[nltk_data]    | Downloading package toolbox to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/toolbox.zip.\n","[nltk_data]    | Downloading package treebank to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/treebank.zip.\n","[nltk_data]    | Downloading package twitter_samples to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/twitter_samples.zip.\n","[nltk_data]    | Downloading package udhr to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/udhr.zip.\n","[nltk_data]    | Downloading package udhr2 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/udhr2.zip.\n","[nltk_data]    | Downloading package unicode_samples to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/unicode_samples.zip.\n","[nltk_data]    | Downloading package universal_tagset to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping taggers/universal_tagset.zip.\n","[nltk_data]    | Downloading package universal_treebanks_v20 to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    | Downloading package vader_lexicon to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    | Downloading package verbnet to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/verbnet.zip.\n","[nltk_data]    | Downloading package verbnet3 to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/verbnet3.zip.\n","[nltk_data]    | Downloading package webtext to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/webtext.zip.\n","[nltk_data]    | Downloading package wmt15_eval to /root/nltk_data...\n","[nltk_data]    |   Unzipping models/wmt15_eval.zip.\n","[nltk_data]    | Downloading package word2vec_sample to\n","[nltk_data]    |     /root/nltk_data...\n","[nltk_data]    |   Unzipping models/word2vec_sample.zip.\n","[nltk_data]    | Downloading package wordnet to /root/nltk_data...\n","[nltk_data]    | Downloading package wordnet2021 to /root/nltk_data...\n","[nltk_data]    | Downloading package wordnet31 to /root/nltk_data...\n","[nltk_data]    | Downloading package wordnet_ic to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/wordnet_ic.zip.\n","[nltk_data]    | Downloading package words to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/words.zip.\n","[nltk_data]    | Downloading package ycoe to /root/nltk_data...\n","[nltk_data]    |   Unzipping corpora/ycoe.zip.\n","[nltk_data]    | \n","[nltk_data]  Done downloading collection all\n"]}]},{"cell_type":"markdown","metadata":{"id":"3_zdk5uPVW-c"},"source":["### 1.3. Download fastText Word Vectors"]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"B8yepOYb6jUV","executionInfo":{"status":"ok","timestamp":1666302916387,"user_tz":-180,"elapsed":26800,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"cf853aab-3d51-4282-c7c5-af351f5da986"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","source":["!unzip \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/public_data (1).zip\""],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"jn-2UO8F6qs9","executionInfo":{"status":"ok","timestamp":1666302921403,"user_tz":-180,"elapsed":5029,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"4ae162fe-cb31-4065-84ba-e91b71eb419e"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Archive:  /content/drive/MyDrive/4 курс/NLP/ДЗ1/public_data (1).zip\n","  inflating: test_data.csv           \n","  inflating: train_data.csv          \n","  inflating: train_solution.csv      \n"]}]},{"cell_type":"code","source":["df = pd.read_csv(\"train_data.csv\")\n","labels = pd.read_csv(\"train_solution.csv\")"],"metadata":{"id":"_9XA2Nuq6qqA"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":[],"metadata":{"id":"kp7Pd5aUPfoC"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df = df.merge(labels, left_on='id', right_on='id')\n","from nltk.corpus import stopwords\n"],"metadata":{"id":"IlUZcQbj6qnP"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df[df.category == 0].sample(40)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"gFkrfMIZPnqy","executionInfo":{"status":"ok","timestamp":1666302925087,"user_tz":-180,"elapsed":17,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"88561e23-59e3-40bc-cb82-f422a82e8b1d"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["          id                                            message  category\n","1273  273101                                            Where D         0\n","2731  274559  To modify, to add gamma and beta, does that mean?         0\n","2809  274637                                     From where? :)         0\n","722   272550            It's just that the 181st is a busy man.         0\n","1360  273188                       How about a little go later?         0\n","1926  273754                                            Of shit         0\n","766   272594            I don't know what you're talking about.         0\n","3141  274969               An online broadcast like last time?)         0\n","127   271955                                            Woooow!         0\n","1662  273490                  It's better on Wednesday, though.         0\n","2408  274236    Suggest a queue for today's assignments showing         0\n","3154  274982  As I've said you before in pm, I'm not the opp...         0\n","1281  273109         You'll be on your way to the next seminar.         0\n","3243  275071                                        lets vote;)         0\n","2636  274464                                           Washroom         0\n","3579  275407  Have you ever consulted her, she cares about r...         0\n","2941  274769                                        Why, Maks?)         0\n","1202  273030                                           October)         0\n","344   272172  Batchnormal logic on the coach doesn't match B...         0\n","3842  275670                                         uraaaaaaaa         0\n","231   272059                             its time to find a job         0\n","1313  273141   By the way, it says only 1 input cannel, alth...         0\n","2788  274616                                 Just further down.         0\n","1969  273797                        and the course at the cadet         0\n","1736  273564                                         Not where.         0\n","190   272018                                      Are you sure?         0\n","855   272683                                          Eblanstvo         0\n","3179  275007                       Let her sing under the door.         0\n","753   272581                                     Try incognito.         0\n","805   272633                                              Guys.         0\n","3612  275440  3 and 1, but 1 is more about the ability to pu...         0\n","611   272439  But edu dep says, that supervisors are about t...         0\n","3272  275100               I think it's better to get it done:)         0\n","3270  275098  aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...         0\n","1525  273353  Oh, by the way, I haven't tried a lot of brows...         0\n","284   272112          Then it's gonna take more time to digest.         0\n","1041  272869                                     Truck, pick-up         0\n","372   272200            What are the most popular auditoriums ?         0\n","765   272593  And if you don't write in it, can you do it on...         0\n","1434  273262                                        No Internet         0"],"text/html":["\n","  <div id=\"df-cbf2b324-332d-489c-9a06-76143a9ac535\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>message</th>\n","      <th>category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>1273</th>\n","      <td>273101</td>\n","      <td>Where D</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2731</th>\n","      <td>274559</td>\n","      <td>To modify, to add gamma and beta, does that mean?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2809</th>\n","      <td>274637</td>\n","      <td>From where? :)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>722</th>\n","      <td>272550</td>\n","      <td>It's just that the 181st is a busy man.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1360</th>\n","      <td>273188</td>\n","      <td>How about a little go later?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1926</th>\n","      <td>273754</td>\n","      <td>Of shit</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>766</th>\n","      <td>272594</td>\n","      <td>I don't know what you're talking about.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3141</th>\n","      <td>274969</td>\n","      <td>An online broadcast like last time?)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>127</th>\n","      <td>271955</td>\n","      <td>Woooow!</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1662</th>\n","      <td>273490</td>\n","      <td>It's better on Wednesday, though.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2408</th>\n","      <td>274236</td>\n","      <td>Suggest a queue for today's assignments showing</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3154</th>\n","      <td>274982</td>\n","      <td>As I've said you before in pm, I'm not the opp...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1281</th>\n","      <td>273109</td>\n","      <td>You'll be on your way to the next seminar.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3243</th>\n","      <td>275071</td>\n","      <td>lets vote;)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2636</th>\n","      <td>274464</td>\n","      <td>Washroom</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3579</th>\n","      <td>275407</td>\n","      <td>Have you ever consulted her, she cares about r...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2941</th>\n","      <td>274769</td>\n","      <td>Why, Maks?)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1202</th>\n","      <td>273030</td>\n","      <td>October)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>344</th>\n","      <td>272172</td>\n","      <td>Batchnormal logic on the coach doesn't match B...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3842</th>\n","      <td>275670</td>\n","      <td>uraaaaaaaa</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>231</th>\n","      <td>272059</td>\n","      <td>its time to find a job</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1313</th>\n","      <td>273141</td>\n","      <td>By the way, it says only 1 input cannel, alth...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2788</th>\n","      <td>274616</td>\n","      <td>Just further down.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1969</th>\n","      <td>273797</td>\n","      <td>and the course at the cadet</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1736</th>\n","      <td>273564</td>\n","      <td>Not where.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>190</th>\n","      <td>272018</td>\n","      <td>Are you sure?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>855</th>\n","      <td>272683</td>\n","      <td>Eblanstvo</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3179</th>\n","      <td>275007</td>\n","      <td>Let her sing under the door.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>753</th>\n","      <td>272581</td>\n","      <td>Try incognito.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>805</th>\n","      <td>272633</td>\n","      <td>Guys.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3612</th>\n","      <td>275440</td>\n","      <td>3 and 1, but 1 is more about the ability to pu...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>611</th>\n","      <td>272439</td>\n","      <td>But edu dep says, that supervisors are about t...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3272</th>\n","      <td>275100</td>\n","      <td>I think it's better to get it done:)</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3270</th>\n","      <td>275098</td>\n","      <td>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1525</th>\n","      <td>273353</td>\n","      <td>Oh, by the way, I haven't tried a lot of brows...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>284</th>\n","      <td>272112</td>\n","      <td>Then it's gonna take more time to digest.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1041</th>\n","      <td>272869</td>\n","      <td>Truck, pick-up</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>372</th>\n","      <td>272200</td>\n","      <td>What are the most popular auditoriums ?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>765</th>\n","      <td>272593</td>\n","      <td>And if you don't write in it, can you do it on...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1434</th>\n","      <td>273262</td>\n","      <td>No Internet</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-cbf2b324-332d-489c-9a06-76143a9ac535')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-cbf2b324-332d-489c-9a06-76143a9ac535 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-cbf2b324-332d-489c-9a06-76143a9ac535');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":6}]},{"cell_type":"code","source":["df.iloc[2247].message"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":36},"id":"AH5B6aEMSk7_","executionInfo":{"status":"ok","timestamp":1666302925500,"user_tz":-180,"elapsed":14,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"1174065d-551e-4508-fa57-3b8f4fb6c5e2"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'Release data: 03.10.2021 Soft deadline: 17.02.2021 23:59 MSK Hard deadline: 21.02.2021 23:59 MSK'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":7}]},{"cell_type":"code","source":["df.category.value_counts()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ie62z90J93-2","executionInfo":{"status":"ok","timestamp":1666302926781,"user_tz":-180,"elapsed":9,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"76f5ebb7-f919-49ea-c116-7b1c276f446b"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0    1428\n","2    1217\n","1    1199\n","Name: category, dtype: int64"]},"metadata":{},"execution_count":8}]},{"cell_type":"markdown","source":["### NEW_data"],"metadata":{"id":"MrmFtI8J8dwM"}},{"cell_type":"code","source":["# !unzip \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/archive (3).zip\"\n","# new_data_fassion = pd.read_json('/content/News_Category_Dataset_v3.json', lines=True)\n","# new_data_fassion.category.value_counts()"],"metadata":{"id":"8iRdDY9EOYwG"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion = new_data_fassion[new_data_fassion['category'] == 'STYLE & BEAUTY'].short_description\n","# categoty = pd.Series([2 for i in range(len(new_data_fassion))])"],"metadata":{"id":"l6u_Qkom8dwO"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion = pd.DataFrame(new_data_fassion).reset_index()"],"metadata":{"id":"yHpMbeR68dwO"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion['category'] = pd.Series([2 for i in range(len(new_data_fassion))])"],"metadata":{"id":"zSxp91fb8dwP"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion =new_data_fassion.drop('index', axis=1)"],"metadata":{"id":"YGJDD9748dwP"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# len(new_data_fassion)"],"metadata":{"id":"5P8tTqb18dwP"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion"],"metadata":{"id":"khpXhqlY8dwQ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion = pd.read_csv('/content/new_data_fashion.csv')"],"metadata":{"id":"VC0yyKGWxRgT"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion = new_data_fassion.rename(columns={\"Unnamed: 0\": \"id\", \"short_description\": \"message\"})"],"metadata":{"id":"-McIzyCdxoz0"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# new_data_fassion"],"metadata":{"id":"1Z-wmSWVyTiT"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# df = pd.concat([df, new_data_fassion], axis=0)"],"metadata":{"id":"EDhEKyKwxbep"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"k8raQmBPPgKj","executionInfo":{"status":"ok","timestamp":1666302932422,"user_tz":-180,"elapsed":15,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"a826a1ff-3f52-49b0-d22b-4010c1dd3f19"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["          id                                            message  category\n","0     271828  Over $616 million in Bitcoin was electrocated ...         1\n","1     271829                          Quiz: Thursday or friday?         0\n","2     271830  The Australian Revenue Authority will start co...         1\n","3     271831   Let's continue😉. I present to you my new review          2\n","4     271832                    Here comes your future palette.         2\n","...      ...                                                ...       ...\n","3839  275667  On the air, the shooter's kms and the man who ...         2\n","3840  275668                    This shit that's off-the-books.         0\n","3841  275669                      Time to go to the sky, tabor.         2\n","3842  275670                                         uraaaaaaaa         0\n","3843  275671                          Albert I only drink VODKA         0\n","\n","[3844 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-5b158086-b4d8-40b7-a662-ddafebe91fc0\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>message</th>\n","      <th>category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>271828</td>\n","      <td>Over $616 million in Bitcoin was electrocated ...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>271829</td>\n","      <td>Quiz: Thursday or friday?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>271830</td>\n","      <td>The Australian Revenue Authority will start co...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>271831</td>\n","      <td>Let's continue😉. I present to you my new review</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>271832</td>\n","      <td>Here comes your future palette.</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>3839</th>\n","      <td>275667</td>\n","      <td>On the air, the shooter's kms and the man who ...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3840</th>\n","      <td>275668</td>\n","      <td>This shit that's off-the-books.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3841</th>\n","      <td>275669</td>\n","      <td>Time to go to the sky, tabor.</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3842</th>\n","      <td>275670</td>\n","      <td>uraaaaaaaa</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3843</th>\n","      <td>275671</td>\n","      <td>Albert I only drink VODKA</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>3844 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-5b158086-b4d8-40b7-a662-ddafebe91fc0')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-5b158086-b4d8-40b7-a662-ddafebe91fc0 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-5b158086-b4d8-40b7-a662-ddafebe91fc0');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":20}]},{"cell_type":"code","source":["# del df\n","# del new_data_fassion"],"metadata":{"id":"-sGCDdNY8dwQ"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["### cont"],"metadata":{"id":"akflvvwhORho"}},{"cell_type":"code","source":["df"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"AMl5N-HrO_b_","executionInfo":{"status":"ok","timestamp":1666302932423,"user_tz":-180,"elapsed":14,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"7596e02b-129d-4a85-8068-532be9dd67fa"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["          id                                            message  category\n","0     271828  Over $616 million in Bitcoin was electrocated ...         1\n","1     271829                          Quiz: Thursday or friday?         0\n","2     271830  The Australian Revenue Authority will start co...         1\n","3     271831   Let's continue😉. I present to you my new review          2\n","4     271832                    Here comes your future palette.         2\n","...      ...                                                ...       ...\n","3839  275667  On the air, the shooter's kms and the man who ...         2\n","3840  275668                    This shit that's off-the-books.         0\n","3841  275669                      Time to go to the sky, tabor.         2\n","3842  275670                                         uraaaaaaaa         0\n","3843  275671                          Albert I only drink VODKA         0\n","\n","[3844 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-43ef8eae-7982-4198-9f80-23e49c35e5db\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>message</th>\n","      <th>category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>271828</td>\n","      <td>Over $616 million in Bitcoin was electrocated ...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>271829</td>\n","      <td>Quiz: Thursday or friday?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>271830</td>\n","      <td>The Australian Revenue Authority will start co...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>271831</td>\n","      <td>Let's continue😉. I present to you my new review</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>271832</td>\n","      <td>Here comes your future palette.</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>3839</th>\n","      <td>275667</td>\n","      <td>On the air, the shooter's kms and the man who ...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3840</th>\n","      <td>275668</td>\n","      <td>This shit that's off-the-books.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3841</th>\n","      <td>275669</td>\n","      <td>Time to go to the sky, tabor.</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3842</th>\n","      <td>275670</td>\n","      <td>uraaaaaaaa</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3843</th>\n","      <td>275671</td>\n","      <td>Albert I only drink VODKA</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>3844 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-43ef8eae-7982-4198-9f80-23e49c35e5db')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-43ef8eae-7982-4198-9f80-23e49c35e5db button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-43ef8eae-7982-4198-9f80-23e49c35e5db');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":22}]},{"cell_type":"code","source":["df.drop(['id'],axis=1,inplace=True)"],"metadata":{"id":"Ofhqy-XeP1sS"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/students_dubki_chat.csv\" .\n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/nlp_chat.csv\" .\n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/ANNA_Sultanova_tg_canal.csv\" .\n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/biutisnaya_blog.csv\" .\n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/cripto_chanal.csv\" .\n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/cripto_chanal_2.csv\" . \n","!cp \"/content/drive/MyDrive/4 курс/NLP/ДЗ1/moda_fashio_beauty_blog.csv\" . "],"metadata":{"id":"E9nTUecMONZx"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["dubki_chat = pd.read_csv('/content/students_dubki_chat.csv')\n","dubki_chat = dubki_chat[['message', 'category']]\n","\n","nlp_chat = pd.read_csv('/content/nlp_chat.csv')\n","nlp_chat = nlp_chat[['message', 'category']]\n","\n","cripto_chanal = pd.read_csv('/content/cripto_chanal.csv')\n","cripto_chanal = cripto_chanal[['message', 'category']]\n","\n","cripto_chanal_2 = pd.read_csv('/content/cripto_chanal_2.csv')\n","cripto_chanal_2 = cripto_chanal_2[['message', 'category']]\n","\n","ANNA_Sultanova_tg_canal = pd.read_csv('/content/ANNA_Sultanova_tg_canal.csv')\n","ANNA_Sultanova_tg_canal = ANNA_Sultanova_tg_canal[['message', 'category']]\n","\n","biutisnaya_blog = pd.read_csv('/content/biutisnaya_blog.csv')\n","biutisnaya_blog = biutisnaya_blog[['message', 'category']]\n","\n","moda_fashio_beauty_blog = pd.read_csv('/content/moda_fashio_beauty_blog.csv')\n","moda_fashio_beauty_blog = moda_fashio_beauty_blog[['message', 'category']]\n","\n"],"metadata":{"id":"LCQDON-vONZy"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df = pd.concat([df,\n","                dubki_chat,\n","                nlp_chat,\n","                cripto_chanal,\n","                cripto_chanal_2,\n","                ANNA_Sultanova_tg_canal,\n","                biutisnaya_blog,\n","                moda_fashio_beauty_blog],\n","                axis=0)"],"metadata":{"id":"E0HoZfF0ONZy"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"TWEYw-jPPvDH","executionInfo":{"status":"ok","timestamp":1666302939792,"user_tz":-180,"elapsed":28,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"fa7bd3dc-8862-41c1-bff9-26272e1ade78"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                               message  category\n","0    Over $616 million in Bitcoin was electrocated ...         1\n","1                            Quiz: Thursday or friday?         0\n","2    The Australian Revenue Authority will start co...         1\n","3     Let's continue😉. I present to you my new review          2\n","4                      Here comes your future palette.         2\n","..                                                 ...       ...\n","289  Exaggerated details were in high demand in 201...         2\n","290  Jeanette Friis Madsen and Tora Valdimars, a du...         2\n","291  RAG AND HOLES \"Now we have a whole department ...         2\n","292  Paris Fashion Week While the schedule for Pari...         2\n","293  Milan is the first of the four fashion capital...         2\n","\n","[20938 rows x 2 columns]"],"text/html":["\n","  <div id=\"df-b4d8b5d6-fe47-40a7-a01f-7fa215190c80\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>message</th>\n","      <th>category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>Over $616 million in Bitcoin was electrocated ...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Quiz: Thursday or friday?</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>The Australian Revenue Authority will start co...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Let's continue😉. I present to you my new review</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>Here comes your future palette.</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>289</th>\n","      <td>Exaggerated details were in high demand in 201...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>290</th>\n","      <td>Jeanette Friis Madsen and Tora Valdimars, a du...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>291</th>\n","      <td>RAG AND HOLES \"Now we have a whole department ...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>292</th>\n","      <td>Paris Fashion Week While the schedule for Pari...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>293</th>\n","      <td>Milan is the first of the four fashion capital...</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>20938 rows × 2 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b4d8b5d6-fe47-40a7-a01f-7fa215190c80')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-b4d8b5d6-fe47-40a7-a01f-7fa215190c80 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-b4d8b5d6-fe47-40a7-a01f-7fa215190c80');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":27}]},{"cell_type":"code","source":["tokenizer = nltk.data.load('tokenizers/punkt/english.pickle')"],"metadata":{"id":"6a3s3dghF3hB"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def review_to_wordlist(review, remove_stopwords=False ):\n","    review = re.sub(r\"http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+\", \" \", review)\n","    review_text = re.sub(\"[^a-zA-Z]\",\" \", review)\n","    words = review_text.lower().split()\n","    if remove_stopwords:\n","        stops = stopwords.words(\"english\")\n","        words = [w for w in words if not w in stops]\n","    return(words)\n","\n","def review_to_sentences(review, tokenizer, remove_stopwords=False):\n","    raw_sentences = tokenizer.tokenize(review.strip())\n","    sentences = []\n","    for raw_sentence in raw_sentences:\n","        if len(raw_sentence) > 0:\n","            sentences.append(review_to_wordlist(raw_sentence, remove_stopwords))\n","    return sentences"],"metadata":{"id":"39g9QnlgF8qc"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df = df.dropna()"],"metadata":{"id":"hWcwh4hjQ6Yy"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["sentences = []  \n","print(\"Parsing sentences from training set...\")\n","for review in df[\"message\"]:\n","    sentences += review_to_sentences(review, tokenizer)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"358kRgQ6F-a1","executionInfo":{"status":"ok","timestamp":1666302941139,"user_tz":-180,"elapsed":725,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"c4347e10-e2fd-416c-da9d-a799f43ffe5f"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Parsing sentences from training set...\n"]}]},{"cell_type":"code","source":["len(sentences)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"WuH2FGg5Wc6N","executionInfo":{"status":"ok","timestamp":1666302941140,"user_tz":-180,"elapsed":13,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"0bc7707d-5090-443c-deea-943635c266bd"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["54212"]},"metadata":{},"execution_count":32}]},{"cell_type":"code","source":["with open('clean_text.txt', 'w') as f:\n","    for s in sentences[:]:\n","        f.write(' '.join(s))\n","        f.write('\\n')"],"metadata":{"id":"NNkkhlgYTYU2"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":49166,"status":"ok","timestamp":1666302990296,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"},"user_tz":-180},"id":"jdOB3X931GBg","outputId":"209285a5-dda0-4cb8-a533-3be26de6ca89"},"outputs":[{"output_type":"stream","name":"stdout","text":["Cloning into 'fastText'...\n","remote: Enumerating objects: 3930, done.\u001b[K\n","remote: Counting objects: 100% (944/944), done.\u001b[K\n","remote: Compressing objects: 100% (140/140), done.\u001b[K\n","remote: Total 3930 (delta 854), reused 804 (delta 804), pack-reused 2986\u001b[K\n","Receiving objects: 100% (3930/3930), 8.24 MiB | 17.16 MiB/s, done.\n","Resolving deltas: 100% (2505/2505), done.\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Processing ./fastText\n","\u001b[33m  DEPRECATION: A future pip version will change local packages to be built in-place without first copying to a temporary directory. We recommend you use --use-feature=in-tree-build to test your packages with this new behavior before it becomes the default.\n","   pip 21.3 will remove support for this functionality. You can find discussion regarding this at https://github.com/pypa/pip/issues/7555.\u001b[0m\n","Collecting pybind11>=2.2\n","  Using cached pybind11-2.10.0-py3-none-any.whl (213 kB)\n","Requirement already satisfied: setuptools>=0.7.0 in /usr/local/lib/python3.7/dist-packages (from fasttext==0.9.2) (57.4.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from fasttext==0.9.2) (1.21.6)\n","Building wheels for collected packages: fasttext\n","  Building wheel for fasttext (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for fasttext: filename=fasttext-0.9.2-cp37-cp37m-linux_x86_64.whl size=3161939 sha256=ba573a8b49e187c3f99fe13957f740ca983cc6008182eda62855b6c9e9ede330\n","  Stored in directory: /tmp/pip-ephem-wheel-cache-6cigshjj/wheels/22/04/6e/b3aba25c1a5845898b5871a0df37c2126cb0cc9326ad0c08e7\n","Successfully built fasttext\n","Installing collected packages: pybind11, fasttext\n","Successfully installed fasttext-0.9.2 pybind11-2.10.0\n"]}],"source":["!git clone https://github.com/facebookresearch/fastText.git\n","!pip3 install fastText/."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"v7ZYnSpx0-oy"},"outputs":[],"source":["import fasttext\n","from fasttext import load_model\n","\n","ft_model = fasttext.train_unsupervised('clean_text.txt', minn=3, maxn=4, dim=300)"]},{"cell_type":"code","source":["ft_model.save_model(\"model.bin\")"],"metadata":{"id":"hFR8jSHL6qiO"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["ans = pd.read_csv('/content/test_data.csv').sample(300)"],"metadata":{"id":"QjZE72VT8tMK"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["ans.to_csv('by_hand.csv')"],"metadata":{"id":"LDMD1ANZ84lY"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["ft_model = load_model('/content/model.bin')\n","words = ft_model.get_words()\n","with open('model.vec','w') as f:\n","    f.write(str(len(words)) + \" \" + str(ft_model.get_dimension()) + \"\\n\")\n","    for w in words:\n","        v = ft_model.get_word_vector(w)\n","        vstr = \"\"\n","        for vi in v:\n","            vstr += \" \" + str(vi)\n","        try:\n","            f.write(w + vstr+'\\n')\n","        except:\n","            pass"],"metadata":{"id":"_XtRfkze6qfP"},"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"T73lLtFe2sYl"},"source":["device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')"],"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from nltk.tokenize import word_tokenize\n","from collections import defaultdict"],"metadata":{"id":"-NwVbcOIAy7o"},"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"4Y1QdMuWMSr5"},"source":["def tokenize(texts):\n","    max_len = 0\n","    tokenized_texts = []\n","    word2idx = {}\n","\n","    word2idx['<pad>'] = 0\n","    word2idx['<unk>'] = 1\n","\n","    idx = 2\n","    for sent in texts:\n","        tokenized_sent = word_tokenize(sent)\n","        tokenized_texts.append(tokenized_sent)\n","        for token in tokenized_sent:\n","            if token not in word2idx:\n","                word2idx[token] = idx\n","                idx += 1\n","\n","        max_len = max(max_len, len(tokenized_sent))\n","    return tokenized_texts, word2idx, max_len\n","\n","def encode(tokenized_texts, word2idx, max_len):\n","    input_ids = []\n","    for tokenized_sent in tokenized_texts:\n","        tokenized_sent += ['<pad>'] * (max_len - len(tokenized_sent))\n","        input_id = [word2idx.get(token) for token in tokenized_sent]\n","        input_ids.append(input_id)\n","    return np.array(input_ids)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"uBX8y7wgNiQh"},"source":["from tqdm.notebook import tqdm\n","def load_pretrained_vectors(word2idx, fname):\n","    print(\"Loading pretrained vectors...\")\n","    fin = open(fname, 'r', encoding='utf-8', newline='\\n', errors='ignore')\n","    n, d = map(int, fin.readline().split())\n","    embeddings = np.random.uniform(-0.25, 0.25, (len(word2idx), d))\n","    embeddings[word2idx['<pad>']] = np.zeros((d,))\n","    count = 0\n","    for line in tqdm(fin):\n","        tokens = line.rstrip().split(' ')\n","        word = tokens[0]\n","        if word in word2idx:\n","            count += 1\n","            embeddings[word2idx[word]] = np.array(tokens[1:], dtype=np.float32)\n","\n","    print(f\"There are {count} / {len(word2idx)} pretrained vectors found.\")\n","    fin.close()\n","    return embeddings"],"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"Uc0J6ZXGloN7"},"source":["Now let's put above steps together."]},{"cell_type":"code","metadata":{"id":"DctpztMIlgtt","outputId":"79d70e79-99b9-47f2-afe2-d1cf4496e08c","executionInfo":{"status":"ok","timestamp":1666297754168,"user_tz":-180,"elapsed":11032,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"colab":{"base_uri":"https://localhost:8080/","height":122,"referenced_widgets":["020764953be747509ecbed599eeeaf08","949c30a86a6448d4b97fd02a11b60811","eca36f7605d147849bc66bb5c8b9cb21","cbc81fe9f41745d7bff961d993ba76e4","190edb9d78df49b5abfae354d105c2c6","22f988f9f9ff4e19958aef12caa72bda","459106e0ff0340b4b8c68d277e9fd11e","0fa99d85b55649fb9227e56ef751aa53","b295dc0513964184aafefeac80693536","878d64634c9d4e3d92d6db323976d563","9cb30a6d9b0b4270bd19a2c7c2ce6dc8"]}},"source":["print(\"Tokenizing...\\n\")\n","tokenized_texts, word2idx, max_len = tokenize(df.message.to_list())\n","input_ids = encode(tokenized_texts, word2idx, max_len)\n","\n","embeddings = load_pretrained_vectors(word2idx, \"model.vec\")\n","embeddings = torch.tensor(embeddings)"],"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Tokenizing...\n","\n","Loading pretrained vectors...\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"020764953be747509ecbed599eeeaf08"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["There are 7730 / 51452 pretrained vectors found.\n"]}]},{"cell_type":"code","metadata":{"id":"k4WinIkRyive"},"source":["from torch.utils.data import TensorDataset, DataLoader, RandomSampler, SequentialSampler\n","\n","def data_loader(train_inputs, val_inputs, train_labels, val_labels, batch_size=50):\n","\n","    train_inputs, val_inputs, train_labels, val_labels =\\\n","    tuple(torch.tensor(data) for data in [train_inputs, val_inputs, train_labels, val_labels])\n","\n","    batch_size = batch_size\n","\n","    train_data = TensorDataset(train_inputs, train_labels)\n","    train_sampler = RandomSampler(train_data)\n","    train_dataloader = DataLoader(train_data, sampler=train_sampler, batch_size=batch_size)\n","\n","    val_data = TensorDataset(val_inputs, val_labels)\n","    val_sampler = SequentialSampler(val_data)\n","    val_dataloader = DataLoader(val_data, sampler=val_sampler, batch_size=batch_size)\n","\n","    return train_dataloader, val_dataloader"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"7eCQRLKNZ-t7"},"source":["from sklearn.model_selection import train_test_split\n","\n","train_inputs, val_inputs, train_labels, val_labels = train_test_split(\n","    input_ids, df.category.to_list(), test_size=0.05, random_state=42, stratify=df.category.to_list())\n","\n","train_dataloader, val_dataloader =data_loader(train_inputs, val_inputs, train_labels, val_labels, batch_size=600)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"ejGLw8TKViBY"},"source":["import torch\n","import torch.nn as nn\n","import torch.nn.functional as F\n","\n","class CNN_NLP(nn.Module):\n","    def __init__(self, pretrained_embedding=None,\n","                 freeze_embedding=False,\n","                 vocab_size=None, embed_dim=300,\n","                 filter_sizes=[3, 4, 5], num_filters=[100, 100, 100],\n","                 num_classes=3, dropout=0.5):\n","\n","        super(CNN_NLP, self).__init__()\n","\n","        if pretrained_embedding is not None:\n","            self.vocab_size, self.embed_dim = pretrained_embedding.shape\n","            self.embedding = nn.Embedding.from_pretrained(pretrained_embedding, freeze=freeze_embedding)\n","        else:\n","            self.embed_dim = embed_dim\n","            self.embedding = nn.Embedding(num_embeddings=vocab_size, embedding_dim=self.embed_dim, padding_idx=0,max_norm=5.0)\n","\n","        self.conv1d_list = nn.ModuleList([\n","            nn.Conv1d(in_channels=self.embed_dim, out_channels=num_filters[i], kernel_size=filter_sizes[i])\n","            for i in range(len(filter_sizes))\n","        ])\n","\n","        self.fc = nn.Linear(np.sum(num_filters), num_classes)\n","        self.dropout = nn.Dropout(p=dropout)\n","\n","    def forward(self, input_ids):\n","        x_embed = self.embedding(input_ids).float()\n","        x_reshaped = x_embed.permute(0, 2, 1)\n","        x_conv_list = [F.relu(conv1d(x_reshaped)) for conv1d in self.conv1d_list]\n","        x_pool_list = [F.max_pool1d(x_conv, kernel_size=x_conv.shape[2]) for x_conv in x_conv_list]\n","        x_fc = torch.cat([x_pool.squeeze(dim=2) for x_pool in x_pool_list], dim=1)\n","        logits = self.fc(self.dropout(x_fc))\n","        return logits"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"lTJnvDI9xuUv"},"source":["import torch.optim as optim\n","\n","def initilize_model(pretrained_embedding=None,\n","                    freeze_embedding=False, vocab_size=None,\n","                    embed_dim=300, filter_sizes=[3, 4, 5, 7],\n","                    num_filters=[100, 100, 100, 100], num_classes=3,\n","                    dropout=0.5, learning_rate=0.01):\n","\n","    cnn_model = CNN_NLP(pretrained_embedding=pretrained_embedding,\n","                        freeze_embedding=freeze_embedding,\n","                        vocab_size=vocab_size,\n","                        embed_dim=embed_dim,\n","                        filter_sizes=filter_sizes,\n","                        num_filters=num_filters,\n","                        num_classes=3,\n","                        dropout=0.5)\n","    cnn_model.to(device)\n","\n","    optimizer = optim.Adadelta(cnn_model.parameters(), lr=learning_rate, rho=0.95)\n","\n","    # optimizer = optim.Adam(cnn_model.parameters(), lr=learning_rate,)\n","         \n","    return cnn_model, optimizer"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"NaW2V4O225fS"},"source":["import random\n","import time\n","\n","loss_fn = nn.CrossEntropyLoss()\n","\n","def set_seed(seed_value=42):\n","\n","    random.seed(seed_value)\n","    np.random.seed(seed_value)\n","    torch.manual_seed(seed_value)\n","    torch.cuda.manual_seed_all(seed_value)\n","\n","def train(model, optimizer, train_dataloader, val_dataloader=None, epochs=10):\n","    \n","    best_accuracy = 0\n","    print(\"Start training...\\n\")\n","    print(f\"{'Epoch':^7} | {'Train Loss':^12} | {'Val Loss':^10} | {'Val Acc':^9} | {'Elapsed':^9}\")\n","    print(\"-\"*60)\n","\n","    for epoch_i in range(epochs):\n","        t0_epoch = time.time()\n","        total_loss = 0\n","        model.train()\n","\n","        for step, batch in enumerate(train_dataloader):\n","            b_input_ids, b_labels = tuple(t.to(device) for t in batch)\n","            model.zero_grad()\n","\n","            logits = model(b_input_ids)\n","\n","            loss = loss_fn(logits, b_labels)\n","            total_loss += loss.item()\n","\n","            loss.backward()\n","\n","            optimizer.step()\n","\n","        avg_train_loss = total_loss / len(train_dataloader)\n","\n","        if val_dataloader is not None:\n","            val_loss, val_accuracy = evaluate(model, val_dataloader)\n","\n","            if val_accuracy > best_accuracy:\n","                best_accuracy = val_accuracy\n","\n","            time_elapsed = time.time() - t0_epoch\n","            print(f\"{epoch_i + 1:7}|{avg_train_loss:12.6f} | {val_loss:10.6f} | {val_accuracy:9.2f} | {time_elapsed:9.2f}\")\n","            \n","    print(\"\\n\")\n","    print(f\"Training complete! Best accuracy: {best_accuracy:.2f}%.\")\n","\n","def evaluate(model, val_dataloader):\n","    model.eval()\n","\n","    val_accuracy = []\n","    val_loss = []\n","\n","    for batch in val_dataloader:\n","        b_input_ids, b_labels = tuple(t.to(device) for t in batch)\n","\n","        with torch.no_grad():\n","            logits = model(b_input_ids)\n","\n","        loss = loss_fn(logits, b_labels)\n","        val_loss.append(loss.item())\n","\n","        preds = torch.argmax(logits, dim=1).flatten()\n","\n","        accuracy = (preds == b_labels).cpu().numpy().mean() * 100\n","        val_accuracy.append(accuracy)\n","\n","    val_loss = np.mean(val_loss)\n","    val_accuracy = np.mean(val_accuracy)\n","\n","    return val_loss, val_accuracy"],"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# CNN-non-static: fastText pretrained word vectors are fine-tuned during training.\n","set_seed(42)\n","cnn_non_static, optimizer = initilize_model(pretrained_embedding=embeddings,\n","                                            freeze_embedding=False, learning_rate=0.2, dropout=0.5)\n","train(cnn_non_static, optimizer, train_dataloader, val_dataloader, epochs=25)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":724},"id":"Q9RpKFRsIHiH","executionInfo":{"status":"error","timestamp":1666299094877,"user_tz":-180,"elapsed":380415,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"b2497b48-f6f7-4e46-ece1-24c91882db93"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Start training...\n","\n"," Epoch  |  Train Loss  |  Val Loss  |  Val Acc  |  Elapsed \n","------------------------------------------------------------\n","      1|    0.856569 |   0.643607 |     81.10 |     22.94\n","      2|    0.528719 |   0.418348 |     88.21 |     23.61\n","      3|    0.381613 |   0.324113 |     90.22 |     23.15\n","      4|    0.314236 |   0.278819 |     91.19 |     22.94\n","      5|    0.278433 |   0.253033 |     91.86 |     23.37\n","      6|    0.251703 |   0.236048 |     92.00 |     23.23\n","      7|    0.236122 |   0.231628 |     91.58 |     23.10\n","      8|    0.216701 |   0.216066 |     92.89 |     23.14\n","      9|    0.206644 |   0.207821 |     92.48 |     23.23\n","     10|    0.198374 |   0.201460 |     92.95 |     23.41\n","     11|    0.187144 |   0.197127 |     93.31 |     23.23\n","     12|    0.184035 |   0.194166 |     93.98 |     23.21\n","     13|    0.176395 |   0.193369 |     93.87 |     23.16\n","     14|    0.171105 |   0.186446 |     93.76 |     23.16\n","     15|    0.166345 |   0.182086 |     93.81 |     23.15\n","     16|    0.162478 |   0.180922 |     94.15 |     23.30\n"]},{"output_type":"error","ename":"KeyboardInterrupt","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-71-f3827d67672c>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      3\u001b[0m cnn_non_static, optimizer = initilize_model(pretrained_embedding=embeddings,\n\u001b[1;32m      4\u001b[0m                                             freeze_embedding=False, learning_rate=0.2, dropout=0.5)\n\u001b[0;32m----> 5\u001b[0;31m \u001b[0mtrain\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcnn_non_static\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0moptimizer\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtrain_dataloader\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mval_dataloader\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mepochs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m25\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;32m<ipython-input-70-3841db0c90fd>\u001b[0m in \u001b[0;36mtrain\u001b[0;34m(model, optimizer, train_dataloader, val_dataloader, epochs)\u001b[0m\n\u001b[1;32m     32\u001b[0m             \u001b[0mtotal_loss\u001b[0m \u001b[0;34m+=\u001b[0m \u001b[0mloss\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mitem\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     33\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 34\u001b[0;31m             \u001b[0mloss\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     35\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     36\u001b[0m             \u001b[0moptimizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mstep\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/_tensor.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(self, gradient, retain_graph, create_graph, inputs)\u001b[0m\n\u001b[1;32m    394\u001b[0m                 \u001b[0mcreate_graph\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    395\u001b[0m                 inputs=inputs)\n\u001b[0;32m--> 396\u001b[0;31m         \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mautograd\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgradient\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0minputs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0minputs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    397\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    398\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mregister_hook\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mhook\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/autograd/__init__.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(tensors, grad_tensors, retain_graph, create_graph, grad_variables, inputs)\u001b[0m\n\u001b[1;32m    173\u001b[0m     Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass\n\u001b[1;32m    174\u001b[0m         \u001b[0mtensors\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgrad_tensors_\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0minputs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 175\u001b[0;31m         allow_unreachable=True, accumulate_grad=True)  # Calls into the C++ engine to run the backward pass\n\u001b[0m\u001b[1;32m    176\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    177\u001b[0m def grad(\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}]},{"cell_type":"code","source":["cnn_non_static.cuda()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"UtBu4I8uK0ez","executionInfo":{"status":"ok","timestamp":1666299158746,"user_tz":-180,"elapsed":504,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"6c6f8b5f-a296-485e-faf0-a49ec1bac6dd"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["CNN_NLP(\n","  (embedding): Embedding(51452, 300)\n","  (conv1d_list): ModuleList(\n","    (0): Conv1d(300, 100, kernel_size=(3,), stride=(1,))\n","    (1): Conv1d(300, 100, kernel_size=(4,), stride=(1,))\n","    (2): Conv1d(300, 100, kernel_size=(5,), stride=(1,))\n","    (3): Conv1d(300, 100, kernel_size=(7,), stride=(1,))\n","  )\n","  (fc): Linear(in_features=400, out_features=3, bias=True)\n","  (dropout): Dropout(p=0.5, inplace=False)\n",")"]},"metadata":{},"execution_count":84}]},{"cell_type":"code","source":["train(cnn_non_static, optimizer, train_dataloader, val_dataloader, epochs=25)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":468},"id":"Hpo5ZTQbKyRb","executionInfo":{"status":"error","timestamp":1666299255527,"user_tz":-180,"elapsed":95559,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"15e0c7d1-8afa-4ea9-a566-bcea4fed203f"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Start training...\n","\n"," Epoch  |  Train Loss  |  Val Loss  |  Val Acc  |  Elapsed \n","------------------------------------------------------------\n","      1|    0.154739 |   0.179036 |     94.01 |     23.01\n","      2|    0.151100 |   0.177128 |     93.59 |     23.61\n","      3|    0.147084 |   0.175009 |     94.15 |     23.12\n","      4|    0.141250 |   0.171185 |     94.03 |     22.92\n"]},{"output_type":"error","ename":"KeyboardInterrupt","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-85-a0348297c41f>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mtrain\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcnn_non_static\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0moptimizer\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtrain_dataloader\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mval_dataloader\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mepochs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m25\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;32m<ipython-input-70-3841db0c90fd>\u001b[0m in \u001b[0;36mtrain\u001b[0;34m(model, optimizer, train_dataloader, val_dataloader, epochs)\u001b[0m\n\u001b[1;32m     32\u001b[0m             \u001b[0mtotal_loss\u001b[0m \u001b[0;34m+=\u001b[0m \u001b[0mloss\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mitem\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     33\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 34\u001b[0;31m             \u001b[0mloss\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     35\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     36\u001b[0m             \u001b[0moptimizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mstep\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/_tensor.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(self, gradient, retain_graph, create_graph, inputs)\u001b[0m\n\u001b[1;32m    394\u001b[0m                 \u001b[0mcreate_graph\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    395\u001b[0m                 inputs=inputs)\n\u001b[0;32m--> 396\u001b[0;31m         \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mautograd\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mbackward\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgradient\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0minputs\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0minputs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    397\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    398\u001b[0m     \u001b[0;32mdef\u001b[0m \u001b[0mregister_hook\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mhook\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/torch/autograd/__init__.py\u001b[0m in \u001b[0;36mbackward\u001b[0;34m(tensors, grad_tensors, retain_graph, create_graph, grad_variables, inputs)\u001b[0m\n\u001b[1;32m    173\u001b[0m     Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass\n\u001b[1;32m    174\u001b[0m         \u001b[0mtensors\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mgrad_tensors_\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mretain_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcreate_graph\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0minputs\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 175\u001b[0;31m         allow_unreachable=True, accumulate_grad=True)  # Calls into the C++ engine to run the backward pass\n\u001b[0m\u001b[1;32m    176\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    177\u001b[0m def grad(\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}]},{"cell_type":"code","metadata":{"id":"xjId-ZUcsL8A"},"source":["def predict(text, model, max_len=62):\n","    model = model.to(\"cpu\")\n","    model.eval()\n","    tokens = word_tokenize(text.lower())\n","    padded_tokens = tokens + ['<pad>'] * (max_len - len(tokens))\n","    input_id = [word2idx.get(token, word2idx['<unk>']) for token in padded_tokens]\n","    input_id = torch.tensor(input_id).unsqueeze(dim=0)\n","\n","    logits = model.forward(input_id.cpu())\n","    probs = F.softmax(logits, dim=1).squeeze(dim=0)\n","\n","    return torch.max(logits, 1)[1]"],"execution_count":null,"outputs":[]},{"cell_type":"code","source":["submition = pd.read_csv('test_data.csv')"],"metadata":{"id":"nY17xYz1DVZF"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["submition"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"gwlY_HZdEMvj","executionInfo":{"status":"ok","timestamp":1666299101999,"user_tz":-180,"elapsed":13,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"77013b0f-6ce6-4b66-e665-3ad71d216b7d"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["           id                                            message\n","0      275672       But a lot of people have a job fair tonight.\n","1      275673  Also, I got only 4 answers on the google form ...\n","2      275674               Vladimir, when will we have seminar?\n","3      275675                              A couple at 111, too?\n","4      275676              It's on Anti-buying. And again, Zara:\n","...       ...                                                ...\n","5922  3143750  The second thing, write all questions and thou...\n","5923  3143751  Can Grayscale Actually Sell Bitcoin (BTC) Afte...\n","5924  3143752  It's not a very operational dude putting them ...\n","5925  3143753  Inspired by Sonia Miro's goddess and made a he...\n","5926  3143754              Okay, you don't have to worry, I did.\n","\n","[5927 rows x 2 columns]"],"text/html":["\n","  <div id=\"df-c117dad0-689a-43ec-ba48-b089e5548d51\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>message</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>275672</td>\n","      <td>But a lot of people have a job fair tonight.</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>275673</td>\n","      <td>Also, I got only 4 answers on the google form ...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>275674</td>\n","      <td>Vladimir, when will we have seminar?</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>275675</td>\n","      <td>A couple at 111, too?</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>275676</td>\n","      <td>It's on Anti-buying. And again, Zara:</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>5922</th>\n","      <td>3143750</td>\n","      <td>The second thing, write all questions and thou...</td>\n","    </tr>\n","    <tr>\n","      <th>5923</th>\n","      <td>3143751</td>\n","      <td>Can Grayscale Actually Sell Bitcoin (BTC) Afte...</td>\n","    </tr>\n","    <tr>\n","      <th>5924</th>\n","      <td>3143752</td>\n","      <td>It's not a very operational dude putting them ...</td>\n","    </tr>\n","    <tr>\n","      <th>5925</th>\n","      <td>3143753</td>\n","      <td>Inspired by Sonia Miro's goddess and made a he...</td>\n","    </tr>\n","    <tr>\n","      <th>5926</th>\n","      <td>3143754</td>\n","      <td>Okay, you don't have to worry, I did.</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5927 rows × 2 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c117dad0-689a-43ec-ba48-b089e5548d51')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-c117dad0-689a-43ec-ba48-b089e5548d51 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-c117dad0-689a-43ec-ba48-b089e5548d51');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":74}]},{"cell_type":"code","source":["cnn_non_static"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"_Y9qaL7ZLL2K","executionInfo":{"status":"ok","timestamp":1666299102000,"user_tz":-180,"elapsed":12,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"a960d90c-c72b-4ed0-a31f-ef8412c34202"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["CNN_NLP(\n","  (embedding): Embedding(51452, 300)\n","  (conv1d_list): ModuleList(\n","    (0): Conv1d(300, 100, kernel_size=(3,), stride=(1,))\n","    (1): Conv1d(300, 100, kernel_size=(4,), stride=(1,))\n","    (2): Conv1d(300, 100, kernel_size=(5,), stride=(1,))\n","    (3): Conv1d(300, 100, kernel_size=(7,), stride=(1,))\n","  )\n","  (fc): Linear(in_features=400, out_features=3, bias=True)\n","  (dropout): Dropout(p=0.5, inplace=False)\n",")"]},"metadata":{},"execution_count":75}]},{"cell_type":"code","source":["ans = []\n","for ind, row in submition.iterrows():\n","    sent = row['message']\n","    # print(sent)\n","    res = int(predict(sent, model=cnn_non_static))\n","    ans.append(res)"],"metadata":{"id":"cvq5lry-EP0A"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["submition['category'] = ans"],"metadata":{"id":"O3oVVnN6FKON"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["submition.category.value_counts()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"J-Duan1gFcNg","executionInfo":{"status":"ok","timestamp":1666299123444,"user_tz":-180,"elapsed":59,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"ac41cf70-8593-4349-88ec-622e7cb5e824"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0    3889\n","1    1131\n","2     907\n","Name: category, dtype: int64"]},"metadata":{},"execution_count":78}]},{"cell_type":"code","source":["answer = submition[['id', 'category']]"],"metadata":{"id":"Jp5kFONX73nU"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["answer.head()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"status":"ok","timestamp":1666299123446,"user_tz":-180,"elapsed":54,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"70c55e48-171a-4a90-b52d-8667c6bfe13f","id":"QQ2jScKb73nU"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["       id  category\n","0  275672         0\n","1  275673         0\n","2  275674         0\n","3  275675         0\n","4  275676         2"],"text/html":["\n","  <div id=\"df-c069979c-62cf-47bb-9538-aa3683735f4c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>275672</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>275673</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>275674</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>275675</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>275676</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c069979c-62cf-47bb-9538-aa3683735f4c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-c069979c-62cf-47bb-9538-aa3683735f4c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-c069979c-62cf-47bb-9538-aa3683735f4c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":80}]},{"cell_type":"code","source":["answer.to_csv(\"abcd.csv\", index = False)"],"metadata":{"id":"mOoR2vAc73nU"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":[],"metadata":{"id":"hSxauoknYsez"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["ft_model"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"oGWxYD5vYscf","executionInfo":{"status":"ok","timestamp":1666303122057,"user_tz":-180,"elapsed":42,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"49073520-c91b-40ef-b02c-cbb13e3ecab3"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["<fasttext.FastText._FastText at 0x7f961f961410>"]},"metadata":{},"execution_count":36}]},{"cell_type":"markdown","source":["# Задание 2"],"metadata":{"id":"v4fUPebcKNyL"}},{"cell_type":"markdown","source":["Задание 2. В процессе решения у вас получилось некоторое признаковое пространство. Получите в нем представление для фразы \"My future\", а затем найдите ближайший пример из обучающей выборки. Полученным сообщением поделитесь с нами. Вот такое NLP-гадание."],"metadata":{"id":"oduG2nbQKQfI"}},{"cell_type":"code","source":["from scipy import spatial\n"],"metadata":{"id":"NOKlMGSzaOpV"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["def avg_feature_vector(sentence, model, num_features):\n","    words = sentence.lower().split()\n","    feature_vec = np.zeros((num_features, ), dtype='float32')\n","    n_words = 0\n","    for word in words:\n","        if word in model:\n","            n_words += 1\n","            feature_vec = np.add(feature_vec, model[word])\n","    if (n_words > 0):\n","        feature_vec = np.divide(feature_vec, n_words)\n","    else:\n","        return None\n","    return feature_vec"],"metadata":{"id":"9mKg5Z-4YsaJ"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["s1_afv =avg_feature_vector('my future', ft_model, 300, )\n","min_dist = -1\n","sent_ans = None\n","for ind, sent in enumerate(df.message.to_list()):\n","    sent = ' '.join(review_to_sentences(sent, tokenizer)[0])\n","    s2_afv = avg_feature_vector(sent,  ft_model, 300, )\n","    if s2_afv is None:\n","        continue\n","    sim = 1 - spatial.distance.cosine(s1_afv, s2_afv)\n","    if sim > min_dist:\n","        print(sent,'-simm-',sim)\n","        min_dist = sim\n","        sent_ans = sent"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"faokbwWgaC_w","executionInfo":{"status":"ok","timestamp":1666303212460,"user_tz":-180,"elapsed":16910,"user":{"displayName":"Михаил Яковлев","userId":"08377244301379534836"}},"outputId":"4929b98a-a2fe-4b47-c11c-96b0b44e1482"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["over million in bitcoin was electrocated in september with wrapped bitcoin wbtc data from coindesk -simm- 0.5447885394096375\n","the australian revenue authority will start collecting taxes from crypto transactions this year -simm- 0.588703989982605\n","let s continue -simm- 0.6197818517684937\n","here comes your future palette -simm- 0.8468741774559021\n","my future husband -simm- 0.9611877799034119\n"]}]},{"cell_type":"code","source":[],"metadata":{"id":"IIi7wYDmaHBW"},"execution_count":null,"outputs":[]}]}